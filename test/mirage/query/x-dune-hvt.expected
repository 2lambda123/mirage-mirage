;; Generated by mirage.%%VERSION%%

(executable
  (name config)
  (flags (:standard -warn-error -A))
  (modules config)
  (libraries mirage))

(rule
  (targets key_gen.ml main.ml manifest.json manifest.ml)
  (deps config.ml mirage.context)
  (action
    (run ./config.exe build --context-file mirage.context --dry-run)))

(executable
  (name main)
  (modes (native object))
  (libraries ocaml-freestanding lwt mirage-bootvar-solo5 mirage-clock-freestanding mirage-logs mirage-runtime mirage-solo5 mirage-types)
  (link_flags -cclib $(pkg-config mirage-solo5 --static --libs-only-l))
  (modules (:standard \ config manifest))
  (forbidden_libraries unix)
  (flags -g -w +A-4-41-42-44 -bin-annot -strict-sequence -principal -safe-string)
  (variants freestanding))

(rule
  (targets manifest.c)
  (deps manifest.json)
  (action (run solo5-elftool gen-manifest manifest.json manifest.c)))

(library
  (name manifest)
  (modules manifest)
  (foreign_stubs
    (language c)
    (names manifest)))

(rule
  (target noop.hvt)
  (mode (promote (until-clean)))
  (deps main.exe.o manifest.o)
  (action
    (run $(pkg-config solo5-bindings-hvt --variable=ld) $(pkg-config solo5-bindings-hvt --variable=ldflags) main.exe.o manifest.o -o %{target} $(pkg-config solo5-bindings-hvt --variable=ldpostflags))))

(install
  (files noop.hvt)
  (section bin)
  (package noop))
